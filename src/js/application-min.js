var font=null;window.proofingPhase="Hamburgers";var fontFormats={truetype:"ttf",opentype:"otf"},json="src/js/proof.json",utc=(new Date).toJSON().slice(0,10).replace(/-/g,"/"),utcNoSlash=(new Date).toJSON().slice(0,10).replace(/-/g,"");function toggleClass(t,e){$("#"+t+" .testarea").toggleClass(e)}function preserveUnique(t){for(var e={},a=[],n=t.length,s=0,l=0;l<n;l++){var i=t[l];1!==e[i]&&(e[i]=1,a[s++]=i)}return a}function showErrorMessage(t){var e=document.getElementById("message");t&&0!==t.trim().length?e.style.display="block":e.style.display="none",e.innerHTML=t}function uint8ToBase64(t){for(var e="",a=t.byteLength,n=0;n<a;n++)e+=String.fromCharCode(t[n]);return window.btoa(e)}function localStorageClear(){localStorage.clear(),localStorage.setItem("proofingPhase","Hamburgers"),location.reload()}function whichFontSize(t){if("t__size-xxl"===t)return"140";if("t__size-xl"===t)return"100";if("t__size-l"===t)return"84";if("t__size-m"===t)return"56";if("t__size-s"===t)return"28";if("t__size-xs"===t)return"14";t=t.length;return t<25?"t__size-xxl":t<50?"t__size-xl":t<95?"t__size-l":t<200?"t__size-m":t<1e3?"t__size-s":"t__size-xs"}function removeElementsByClass(t){for(var e=document.getElementsByClassName(t);0<e.length;)e[0].parentNode.removeChild(e[0])}function removeElementsByID(t){var e=$("#"+t);e.slideUp("slow",function(){e.remove()})}function saveData(t,e){"undefined"!=typeof Storage&&("thisContent"!==e?localStorage.setItem(t,e):(e=$("#"+t).text(),localStorage.setItem(t,e)))}function setStage(d){var v=document.getElementById("section__article-app"),h=document.getElementById("section__header-stage-buttons"),_="",b="",y="";$.getJSON(json,function(e){for(stage in e){if(stage===d){_="",gsubFeatures=font.tables.gsub.features;var a,n,s=[];for(a in gsubFeatures){var l=gsubFeatures[a].tag;null!=e.Features[l]&&s.push(l)}for(n in s=preserveUnique(s),e[stage])if("Features"!==stage||s.includes(n)){var i,o,r,c=whichFontSize(e[stage][n]),f="section__proofing-"+n,m="item--"+n,u=m+"-slider",p="";for(localStorage.getItem(u+"-fontSize-val")?p+="font-size: "+(i=localStorage.getItem(u+"-fontSize-val"))+"pt;":i=whichFontSize(c),localStorage.getItem(u+"-lineHeight-val")?p+="line-height: "+(o=localStorage.getItem(u+"-lineHeight-val"))+";":(o="1.2",p+="line-height: 1.2;"),localStorage.getItem(u+"-letterSpacing-val")?p+="letter-spacing: "+(r=localStorage.getItem(u+"-letterSpacing-val"))+"em;":(r="0em",p+="letter-spacing: 0em;"),_+='<div id="'+m+'" class="item">',_+='<button class="btn btn-link add-item-above chip" onclick="insertField(\''+m+"')\">+ Add Proof Window</button>",_+='<div class="u__flex">',_+='<div class="item__sliders mr-6 pt-2"><div class="item__sliders-wrapper">',_+='<label for="'+u+'-fontSize">Font Size </label><span class="t__right" id="'+u+'-fontSize-val">'+i+'pt</span><input id="'+u+'-fontSize" type="range" class="slider" min="4" max="160" step="2" value="'+i+'" oninput="passStyleValue(\''+m+"', 'fontSize', this.value)\">",_+='<label for="'+u+'-lineHeight">Line Height </label><span class="t__right" id="'+u+'-lineHeight-val">'+o+'</span><input id="'+u+'-lineHeight" type="range" class="slider" min="0.6" max="3.0" step="0.01" value="'+o+'" oninput="passStyleValue(\''+m+"', 'lineHeight', this.value)\">",_+='<label for="'+u+'-letterSpacing">Letter Spacing </label><span class="t__right" id="'+u+'-letterSpacing-val">'+r+'</span><input id="'+u+'-letterSpacing" type="range" class="slider" min="-0.4" max="0.4" step="0.01" value="'+r+'" oninput="passStyleValue(\''+m+"', 'letterSpacing', this.value)\">",function(){if(font.tables.fvar){var t,e,a=[];for(t in font.tables.fvar.axes){var n=font.tables.fvar.axes[t].tag;a.push(n)}for(e in y+="font-variation-settings:",font.tables.fvar.axes){var s,l=font.tables.fvar.axes[e].minValue,i=font.tables.fvar.axes[e].maxValue,n=font.tables.fvar.axes[e].tag,o=font.tables.fvar.axes[e].name.en;s=localStorage.getItem(m+"-slider-"+n+"-val")?localStorage.getItem(m+"-slider-"+n+"-val"):font.tables.fvar.axes[e].defaultValue,y+="'"+n+"' "+s+" ",_+='<label for="'+u+"-"+n+'">'+o+" </label>",_+='<span class="t__right" id="'+u+"-"+n+'-val">'+s+"</span>",_+='<input id="'+u+"-"+n+'" type="range" class="slider" min="'+l+'" max="'+i+'" value="'+s+'" oninput="passfvarValue(\''+m+"', '"+n+"', this.value, '"+a+"')\">",e!=font.tables.fvar.axes.length-1&&(y+=", ")}y+=";"}}(),_+='<div id="btn__wrapper-case" class="u__flex btn__wrapper">',_+='<button class="btn btn-link textTransform-uppercase mr-1 mb-1" title="Uppercase" onclick="passStyleValue(\''+m+"','textTransform', 'uppercase')\">TT</button>",_+='<button class="btn btn-link textTransform-capitalize mr-1 mb-1" title="Capitalize" onclick="passStyleValue(\''+m+"','textTransform', 'capitalize')\">Tt</button>",_+='<button class="btn btn-link textTransform-lowercase mr-1 mb-1" title="Lowercase" onclick="passStyleValue(\''+m+"','textTransform', 'lowercase')\">tt</button>",_+="</div>",_+='<div id="btn__wrapper-columns" class="u__flex btn__wrapper">',_+='<button class="btn btn-link column-count-1 mr-1 mb-1" title="1 column layout" onclick="passStyleValue(\''+m+"','column-count', '1')\">☱</button>",_+='<button class="btn btn-link column-count-2 mr-1 mb-1" title="2 column layout" onclick="passStyleValue(\''+m+"','column-count', '2')\">☷</button>",_+='<button class="btn btn-link column-count-3 mr-1 mb-1" title="3 column layout" onclick="passStyleValue(\''+m+"','column-count', '3')\">☵</button>",_+="</div>",_+='<div class="btn__wrapper t_left mt-3">',t=0;t<s.length;t++){var l=s[t],g=e.Features[l].abstract;_+='<div class="btn__setfont mt-1 d-block">',_+='<input id="'+m+"-checkbox-"+l+'" type="checkbox" name="" onclick="passfeatValue(\''+m+"', '"+l+"', '"+s+"')\"> ",_+=g+'<span class="float-right">'+l+"</span></div>"}_+="</div>",_+='<button class="btn btn-secondary mr-1 mb-1 mt-6" title="Applies styles above to all text fields currently visable." onclick="passStyleValue(\''+m+"','idiocracy','global')\">Global Idiocracy</button>",_+="</div>",_+="</div>",_+='<div class="item__proof">',_+='<button class="btn btn-link remove-item-this" onclick="removeElementsByID(\''+m+"')\">×</button>","Features"===stage?(c=whichFontSize(e[stage][n].sample),_+='<h6 class="h6" title="'+e[stage][n].definition+'" contentEditable="true" onkeyup="saveData(\''+f+"-title', 'thisContent')\">"+n+'</h6><span class="testarea-values small"> <span class="fontSize">fontSize: '+i+'pt</span> <span class="lineHeight">lineHeight: '+o+'</span> <span class="letterSpacing">letterSpacing: '+r+"</span></span>",_+='<div id="'+f+'" style="'+p+" "+y+'" class="t__importedfontfamily '+c+' testarea" contenteditable="true" spellcheck="false" onkeyup="saveData(\''+f+"', 'thisContent')\">",localStorage.getItem(f)?_+=localStorage.getItem(f):_+=e[stage][n].sample):(_+='<h6 contentEditable="true" onkeyup="saveData(\''+f+"-title', 'thisContent')\">"+n+'</h6><span class="testarea-values small"> <span class="fontSize">fontSize: '+i+'pt</span> <span class="lineHeight">lineHeight: '+o+'</span> <span class="letterSpacing">letterSpacing: '+r+"</span></span>",_+='<div id="'+f+'" style="'+p+" "+y+'" class="t__importedfontfamily '+c+' testarea" contentEditable="true" spellcheck="false" onkeyup="saveData(\''+f+"', 'thisContent')\">",localStorage.getItem(f)?_+=localStorage.getItem(f):_+=e[stage][n]),_+="</div>",_+="</div>",_+="</div>",_+="</div>"}}""===_&&(_+='<div class="item u__flex t__center"><div class="item__proof">No features found! :...(</div></div>'),stage===d?b+='<li class="tab-item active tab__setstage" onclick="setStage(\''+stage+'\')"><a class="#">'+stage+"</a></li>":b+='<li class="tab-item tab__setstage" onclick="setStage(\''+stage+'\')"><a class="#">'+stage+"</a></li>"}h.innerHTML=b,v.innerHTML=_,$("#style__opentype-features").html("")}),saveData("proofingPhase",d)}function insertField(t){var e=jQuery("#"+t).clone();$("#"+t).prepend(e);t=e.height();e.css("height","auto"),e.css("height","0px").animate({height:t},600)}function passStyleValue(t,e,a){var n;"fontSize"===e||"lineHeight"===e||"letterSpacing"===e?(saveData(t+"-slider-"+e+"-val",a),"fontSize"===e?a+="pt":"letterSpacing"===e&&(a+="em"),document.getElementById(t+"-slider-"+e+"-val").innerHTML=a):saveData(t+e,a),"idiocracy"===e?(n=$("#"+t+" .testarea").attr("style"),$(".testarea").attr("style",n)):$("#"+t+" .testarea").css(e,a),$("#"+t+" .testarea-values").has("."+e).length?$("#"+t+" .testarea-values ."+e).html(" "+e+": "+a):(n="<span class='"+e+"'> "+e+": "+a+"</span>",$("#"+t+" .testarea-values").append(n)),$(".btn."+e+"-"+a).addClass("active").siblings(".btn").removeClass("active")}function passfvarValue(t,e,a,n){saveData(t+"-slider-"+e+"-val",document.getElementById(t+"-slider-"+e+"-val").innerHTML=a);var s,l,i="";if(1==(n=!Array.isArray(n)?n.split(","):n).length)i+="'"+e+"' "+a+" ";else for(f=0;f<n.length;f++)e==n[f]?i+="'"+e+"' "+a:(s=document.getElementById(t+"-slider-"+n[f]).value,i+="'"+String(n[f])+"' "+s),f!=n.length-1&&(i+=", ");$("#"+t+" .testarea").css("font-variation-settings",i),$("#"+t+" .testarea-values").has(".fvar").length?$("#"+t+" .testarea-values .fvar").html(i):(l="<span class='fvar'>"+i+"</span>",$("#"+t+" .testarea-values").append(l))}function passfeatValue(t,e,a){var n=a.split(","),s="";for(f=0;f<n.length;f++)document.getElementById(t+"-checkbox-"+n[f]).checked&&(s+="'"+n[f]+"',");s=s.replace(/,\s*$/,""),$("#"+t+" .testarea").css("font-feature-settings",s)}function displayFontData(t){var e,a="";for(e in font.tables){font.tables[e];"cmap"===e&&(s=font.tables.cmap.glyphIndexMap,n=Object.keys(s).length,window.proofingPhase=n<=100?"Hamburgers":400<=n?"Diacritics":"Spacing");var n,s=font.outlinesFormat,s=fontFormats[s];"name"!==e||(nameHtml="",n=font.names.designer?font.names.designer.en:"No Designer Name :(",s=font.names.postScriptName?font.names.postScriptName.en:"Font Name",nameHtml+='<h6 class="h6 section__header-name u__flex-grow-1 t__left" contenteditable="true" spellcheck="false">'+n+"</h6>",nameHtml+='<a class="off-canvas-toggle h6 section__header-name u__flex-grow-1 t__center p-sticky" href="#sidebar-demo" spellcheck="false">'+s+"</a>",a+='.t__importedfontfamily { font-family: "'+t+'" }',nameHtml+='<h6 class="h6 section__header-name  u__flex-grow-1 t__right">'+utc+"</h6>",document.getElementById("section__header-names").innerHTML=nameHtml)}$("#style__fontfamily").html(a),localStorage.getItem("proofingPhase")?setStage(localStorage.getItem("proofingPhase")):setStage(window.proofingPhase)}function onFontLoaded(t,e,a){window.font=t;var n=[];n.push(t),window.URL.createObjectURL(new Blob(n,{type:"application/zip"})),displayFontData(window.fontFamily=a),"localhost"!==location.hostname&&"127.0.0.1"!==location.hostname&&""!==location.hostname||(localStorage.setItem("fontFamily",a),localStorage.setItem("fontFamilySource",e))}function onReadFile(t){var e=t.target.files[0],a=t.target.files;if(1<t.target.files.length)for(var n=0;n<t.target.files.length;n++){var s,l=a[n];(s=new FileReader).onload=function(t){new DataView(t.target.result);var e=opentype.parse(t.target.result);e.file={name:t.name,lastModified:t.lastModified,size:t.size,type:t.type},e.type="upload",e.fontFamily=e.names.postScriptName.en,e.menuName=e.fontFamily;t=new Uint8Array(t.target.result);$("#style__fontface").append("@font-face {font-family:'"+e.fontFamily+"'; src: url('data:;base64,"+uint8ToBase64(t)+"') format('truetype');} "),$("#section__header-file-buttons").append('<span class="btn__setfont chip d-block" title="'+e.fontFamily+'" id="btn__setfont-'+e.fontFamily+'" onclick="setFont(\'data:;base64,'+uint8ToBase64(t)+"', '"+e.fontFamily+"')\">"+e.fontFamily+"</span>")},s.readAsArrayBuffer(l)}else(s=new FileReader).onload=function(t){try{var e=opentype.parse(t.target.result),a=e.names.postScriptName.en;onFontLoaded(e,"fonts/"+e.names.postScriptName.en,a),e.file={name:t.name,lastModified:t.lastModified,size:t.size,type:t.type},e.type="user:local";var n=new Uint8Array(t.target.result);$("#style__fontface").html("@font-face {font-family:'"+window.fontFamily+"';  src: url('data:;base64,"+uint8ToBase64(n)+"') format('truetype');} "),showErrorMessage("")}catch(t){throw showErrorMessage(t.toString()),t.stack&&console.log(t.stack),t}},s.onerror=function(t){showErrorMessage(t.toString())},s.readAsArrayBuffer(e)}function setFont(a,n){opentype.load(a,function(t,e){onFontLoaded(e,a,n)})}function serverLoad(){var t=document.getElementById("section__header-file-buttons");setFont("fonts/gooper-VF.ttf","gooper-VF-ttf"),$("#style__fontface").html('@font-face { font-family: "gooper-VF-ttf"; src: url("fonts/gooper-VF.ttf");}');t.innerHTML='<form class="box has-advanced-upload" method="post" action="" enctype="multipart/form-data"><div class="box__input"><input id="fontInput" class="box__file" type="file" name="files[]"  data-multiple-caption="{count} files selected" multiple /></form><div id="message"></div><div id="listfonts"></div>',document.getElementById("fontInput").addEventListener("change",onReadFile,!1)}function localLoad(){var i=document.getElementById("section__header-file-buttons");document.getElementById("section__header-file-buttons").innerHTML="Place fonts you want to proof into <code>/fonts</code> to begin";var o="",r="",c="";$.get("../src/txt/fonts.txt",{},function(t){c=t.split("fonts/");for(var e=[],a=0;a<c.length;a++)""!=c[a]&&(thisFont=c[a].trim(),e.push(thisFont));preserveUnique(e),e.sort();for(var n,a=0;a<e.length;a++){var s=e[a],l=s.split(".").pop();thisFontName=s.replace("ignore/","").replace("-"," ").replace(/([A-Z])/g," $1").trim(),thisFontFamily=s.replace(".","-"),o+='<div class="btn__setfont chip d-block" title="'+s+'" id="btn__setfont-'+thisFontFamily+'" onclick="setFont(\'fonts/'+s+"', '"+thisFontFamily+"')\">"+thisFontName.substring(0,thisFontName.length-4)+'<span class="float-right">'+l+"</span></div>",r+='@font-face { font-family: "'+thisFontFamily+'"; src: url("fonts/'+s+'");}'}i.innerHTML=o,t=localStorage.getItem("fontFamilySource")?(n=localStorage.getItem("fontFamilySource"),localStorage.getItem("fontFamily")):(n="fonts/"+e[e.length-1],thisFontFamily),setFont(n,t),$("#style__fontface").append(r)},"text")}window.onload=function(){("localhost"===location.hostname||"127.0.0.1"===location.hostname||""===location.hostname?localLoad:serverLoad)(),$("#section__header-file-buttons").on("click",".btn__setfont",function(){$(this).addClass("active").siblings().removeClass("active"),$(this).addClass("visited")}),$("#section__header-stage-buttons").on("click",".btn__setstage",function(){$(this).addClass("active").siblings().removeClass("active")}),$("#btn__view-tools-toggle").on("click",function(t){$(".body__idiotproofed").toggleClass("tools-visible")}),document.body.className+=" loaded"};var isAnimating=null;function animatefvarValue(t,e,a,n,s,l){document.getElementById(t+"-slider-"+e+"-val").value=a;var i="";if(null!==isAnimating)$("#style__fvar-animation").html(""),isAnimating=null;else{var o,r=function(t,e){CSSRule.WEBKIT_KEYFRAMES_RULE?i+="@-webkit-keyframes "+t+" {"+e+"}":CSSRule.MOZ_KEYFRAMES_RULE?i+="@-moz-keyframes "+t+" {"+e+"}":CSSRule.KEYFRAMES_RULE&&(i+="@keyframes "+t+" {"+e+"}")},c="";if(1==(l=!Array.isArray(l)?l.split(","):l).length)r(e+"infinite",'0%, 100% {font-variation-settings:"'+e+'" '+a+';}25% {font-variation-settings:"'+e+'" '+n+';}50% {font-variation-settings:"'+e+'" '+s+";}");else{for(f=0;f<l.length;f++)e!==l[f]&&(o=document.getElementById(id+"-slider-"+l[f]).value,c+="'"+String(l[f])+"' "+o+",");r(e+"infinite",'0%, 100% {font-variation-settings:"'+e+'" '+a+", "+(c=c.substring(0,c.length-1))+';}25% {font-variation-settings:"'+e+'" '+n+", "+c+';}50% {font-variation-settings:"'+e+'" '+s+", "+c+";}")}$("#style__fvar-animation").html(i),$("#"+t).css("font-variation-settings","unset").css("animation",e+"infinite 4s ease-in-out infinite"),isAnimating=!0}}