var font=null;window.fontSize=16,window.lineHeight=1.3,window.letterSpacing=0;var fontFormats={truetype:"ttf",opentype:"otf"},json="js/proof.json",utc=(new Date).toJSON().slice(0,10).replace(/-/g,"/"),utcNoSlash=(new Date).toJSON().slice(0,10).replace(/-/g,"");function toggleClass(e,t){document.getElementById(e).classList.toggle(t)}function stageWatchNSave(e,t){"content"===t?($(e).on("click",function(){this.contentEditable=!0,this.focus(),editBtn.innerHTML="Editing...",editBtn.classList.remove("saved"),editBtn.classList.add("editing")}),$(e).focusout(function(){this.contentEditable=!1;for(var e=0;e<testareas.length;e++)localStorage.setItem(this.getAttribute("id"),this.innerHTML);editBtn.innerHTML="Saved",editBtn.classList.remove("editing"),editBtn.classList.add("saved")})):"slider"===t&&($(e).on("focus",function(){editBtn.innerHTML="Editing...",editBtn.classList.remove("saved"),editBtn.classList.add("editing")}),$(e).mouseup(function(){editBtn.innerHTML="Saved",editBtn.classList.remove("editing"),editBtn.classList.add("saved")}))}function setStage(g){var u=document.getElementById("section__article-app"),m=document.getElementById("section__header-stage-buttons"),v="",p="",_="";$.getJSON(json,function(e){for(stage in e){if(stage===g){var t=function(){if(font.tables.fvar){var e=[];for(var t in font.tables.fvar.axes){var n=font.tables.fvar.axes[t].tag;e.push(n)}for(var a in font.tables.fvar.axes){var i=font.tables.fvar.axes[a].minValue,o=font.tables.fvar.axes[a].maxValue,s=(n=font.tables.fvar.axes[a].tag,font.tables.fvar.axes[a].name.en),l=font.tables.fvar.axes[a].defaultValue;v+='<label for="'+f+"-"+n+'">'+s+" </label>",v+='<span id="'+f+"-"+n+'-val">'+l+"</span>",v+="<button onclick=\"animatefvarValue('"+r+"', '"+n+"', '"+l+"', '"+i+"', '"+o+"', '"+e+"')\">ease</button>",v+='<input id="'+f+"-"+n+'" type="range" class="slider" min="'+i+'" max="'+o+'" value="'+l+'" oninput="passfvarValue(\''+r+"', '"+n+"', this.value, '"+e+"')\">"}}};v="",gsubFeatures=font.tables.gsub.features;var n=[];for(var a in gsubFeatures)if("aalt"!==gsubFeatures[a].tag){var i=gsubFeatures[a].tag;n.push(i)}for(var o in n=preserveUnique(n),e[stage])if("FEAT"!==stage||n.includes(o)){var s=whichFontSize(e[stage][o]),r="section__proofing-"+o,f=r+"-slider",l="item--"+o,c="";if(localStorage.getItem(f+"-fontSize-val"))c+="font-size: "+(d=localStorage.getItem(f+"-fontSize-val"))+"px;";else var d=whichFontSize(s);if(v+='<div id="'+l+'" class="item u__flex">',v+='<div class="item__sliders"><div class="item__sliders-wrapper">',v+='<label for="'+f+'-fontSize">Font Size </label><span id="'+f+'-fontSize-val">'+d+'</span><input id="'+f+'-fontSize" type="range" class="slider" min="4" max="160" step="2" value="'+d+'" oninput="passStyleValue(\''+r+"', 'fontSize', this.value)\">",stageWatchNSave(f+"-fontSize-val","slider"),v+='<label for="'+f+'-lineHeight">Line Height </label><span id="'+f+'-lineHeight-val">'+lineHeight+'</span><input id="'+f+'-lineHeight" type="range" class="slider" min="0.6" max="5.0" step="0.05" value="'+lineHeight+'" oninput="passStyleValue(\''+r+"', 'lineHeight', this.value)\">",stageWatchNSave(f+"-lineHeight-val","slider"),v+='<label for="'+f+'-letterSpacing">Letter Spacing </label><span id="'+f+'-letterSpacing-val">'+letterSpacing+'</span><input id="'+f+'-letterSpacing" type="range" class="slider" min="-0.4" max="0.4" step="0.01" value="'+letterSpacing+'" oninput="passStyleValue(\''+r+"', 'letterSpacing', this.value)\">",stageWatchNSave(f+"-letterSpacing-val","slider"),t(),v+='<div class="add-item-above"><button onclick="insertField(\''+l+"')\">+</button></div>",v+='<div class="remove-item-this"><button onclick="removeElementsByID(\''+l+"')\">-</button></div>","FEAT"===stage&&(v+='<div class="turn-off-feature"><button onclick="toggleClass(\''+r+"', '"+r+"')\">Feature</button></div>"),v+="</div>",v+="</div>",v+='<div class="item__proof">',"FEAT"===stage){_+="."+r+' { font-feature-settings: "'+o+'" 1;}';s=whichFontSize(e[stage][o].sample);v+='<h3 class="h3">'+o+' <span class="tooltip tooltip__features">'+e[stage][o].definition+"</span></h3>",v+='<div id="'+r+'" style="'+c+'" class="t__importedfontfamily '+s+' testarea" contenteditable="true">',localStorage.getItem(r)?v+=localStorage.getItem(r):v+=e[stage][o].sample}else v+='<h3 class="h3">'+o+"</h3>",v+='<div id="'+r+'" style="'+c+'" class="t__importedfontfamily '+s+' testarea" contentEditable="true">',localStorage.getItem(r)?v+=localStorage.getItem(r):v+=e[stage][o];stageWatchNSave(r,"content"),v+="</div>",v+="</div>",v+="</div>"}}""===v&&(console.log(v),v+='<div class="item u__flex t__center"><div class="item__proof">No features found! :...(</div></div>'),p+='<button class="btn active btn__setstage" onclick="setStage(\''+stage+"')\">"+stage+"</button>"}m.innerHTML=p,u.innerHTML=v,$("#style__opentype-features").html(_)});var e=document.getElementById("btn__edit-content");e.innerHTML="Save",e.classList.remove("editing"),e.classList.remove("saved"),e.classList.add("need-save")}function localStorageSave(e,t){for(var n=document.getElementsByClassName(e),a=0;a<n.length;a++)localStorage.setItem(n[a].getAttribute("id"),n[a][t])}function localStorageClear(){localStorage.clear(),location.reload()}function whichFontSize(e){if("t__size-xxl"===e)return"140";if("t__size-xl"===e)return"100";if("t__size-l"===e)return"84";if("t__size-m"===e)return"56";if("t__size-s"===e)return"28";if("t__size-xs"===e)return"14";var t=e.length;return t<25?"t__size-xxl":t<50?"t__size-xl":t<95?"t__size-l":t<200?"t__size-m":t<1e3?"t__size-s":"t__size-xs"}function isVariableFont(){return!!font.tables.fvar}function removeElementsByClass(e){for(var t=document.getElementsByClassName(e);0<t.length;)t[0].parentNode.removeChild(t[0])}function removeElementsByID(e){document.getElementById(e).outerHTML=""}var fieldcount=0;function insertField(e){fieldcount+=1;var t=jQuery("#"+e).clone().removeAttr("id");t=$(t).filter("#username").children("div").attr("id","item--"+fieldcount).children("div").html("new user"),$("#"+e).prepend(t)}function saveData(e,t){"undefined"!=typeof Storage&&localStorage.setItem(e,t)}function passStyleValue(e,t,n){if("item__proof"===e){e=document.getElementsByClassName(e);saveData("item__proof-slider-"+t+"-val",document.getElementById("item__proof-slider-"+t+"-val").innerHTML=n),"fontSize"===t?n+="px":"letterSpacing"===t&&(n+="em"),$(e).css(t,n)}else saveData(e+"-slider-"+t+"-val",document.getElementById(e+"-slider-"+t+"-val").innerHTML=n),"fontSize"===t?n+="px":"letterSpacing"===t&&(n+="em"),document.getElementById(e).style[t]=n}function passfvarValue(e,t,n,a){saveData(e+"-slider-"+t+"-val",document.getElementById(e+"-slider-"+t+"-val").value=n),Array.isArray(a)||(a=a.split(","));var i="";if(1==a.length)i+="'"+t+"' "+n+" ";else for(f=0;f<a.length;f++){if(t==a[f])i+="'"+t+"' "+n;else{var o=document.getElementById(e+"-slider-"+a[f]).value;i+="'"+String(a[f])+"' "+o}f!=a.length-1&&(i+=", ")}$("#"+e).css("font-variation-settings",i)}var isAnimating=null;function animatefvarValue(e,t,n,a,i,o){document.getElementById(e+"-slider-"+t+"-val").value=n;var s="",l=null;if(null!==isAnimating)$("#style__fvar-animation").html(""),isAnimating=null;else{l=function(e,t){CSSRule.WEBKIT_KEYFRAMES_RULE?s+="@-webkit-keyframes "+e+" {"+t+"}":CSSRule.MOZ_KEYFRAMES_RULE?s+="@-moz-keyframes "+e+" {"+t+"}":CSSRule.KEYFRAMES_RULE&&(s+="@keyframes "+e+" {"+t+"}")},Array.isArray(o)||(o=o.split(","));var r="";if(1==o.length)l(t+"infinite",'0%, 100% {font-variation-settings:"'+t+'" '+n+';}25% {font-variation-settings:"'+t+'" '+a+';}50% {font-variation-settings:"'+t+'" '+i+";}");else{for(f=0;f<o.length;f++){if(t!==o[f]){var c=document.getElementById(e+"-slider-"+o[f]).value;r+="'"+String(o[f])+"' "+c}f!=o.length-1&&(r+=", ")}l(t+"infinite",'0%, 100% {font-variation-settings:"'+t+'" '+n+" "+r+';}25% {font-variation-settings:"'+t+'" '+a+" "+r+';}50% {font-variation-settings:"'+t+'" '+i+" "+r+";}")}$("#style__fvar-animation").html(s),$("#"+e).css("font-variation-settings","unset").css("animation",t+"infinite 4s ease-in-out infinite"),isAnimating=!0}}function displayFontData(e){var t,n="";for(t in font.tables){if(font.tables[t],"cmap"===t){var a=font.tables.cmap.glyphIndexMap,i=Object.keys(a).length;window.proofingPhase=i<=100?"HAMB":400<=i?"DIAC":"OHNO"}var o=font.outlinesFormat;if(o=fontFormats[o],"name"!==t);else{if(nameHtml="",font.names.designer)var s=font.names.designer.en;else s="Designer Name";if(font.names.postScriptName)var l=font.names.postScriptName.en;else l="Font Name";nameHtml+='<h6 class="h6 section__header-name u__flex-grow-1 t__left" contenteditable="true">'+s+"</h6>",nameHtml+='<h6 class="h6 section__header-name u__flex-grow-1 t__center" contenteditable="true">'+l+"</h6>",n+='.t__importedfontfamily { font-family: "'+e+'" }',nameHtml+='<h6 class="h6 section__header-name  u__flex-grow-1 t__right">'+utc+"</h6>",document.getElementById("section__header-names").innerHTML=nameHtml}}$("#style__fontfamily").html(n),setStage(window.proofingPhase)}function preserveUnique(e){for(var t={},n=[],a=e.length,i=0,o=0;o<a;o++){var s=e[o];1!==t[s]&&(t[s]=1,n[i++]=s)}return n}function onFontLoaded(e,t,n){window.font=e;var a=[];a.push(e),window.URL.createObjectURL(new Blob(a,{type:"application/zip"})),displayFontData(window.fontFamily=n),"localhost"!==location.hostname&&"127.0.0.1"!==location.hostname&&""!==location.hostname||(localStorage.setItem("fontFamily",n),localStorage.setItem("fontFamilySource",t))}function showErrorMessage(e){var t=document.getElementById("message");e&&0!==e.trim().length?t.style.display="block":t.style.display="none",t.innerHTML=e}function uint8ToBase64(e){for(var t="",n=e.byteLength,a=0;a<n;a++)t+=String.fromCharCode(e[a]);return window.btoa(t)}function onReadFile(e){var t=e.target.files[0],n=new FileReader;n.onload=function(e){try{var t=opentype.parse(e.target.result),n=t.names.postScriptName.en;onFontLoaded(t,"fonts/"+t.names.postScriptName.en,n),t.file={name:e.name,lastModified:e.lastModified,size:e.size,type:e.type},t.type="user:local";var a=new Uint8Array(e.target.result);$("#style__fontface").html("@font-face {font-family:'"+window.fontFamily+"'; src: url('data:;base64,"+uint8ToBase64(a)+"') format('truetype');} "),showErrorMessage("")}catch(e){throw showErrorMessage(e.toString()),e.stack&&console.log(e.stack),e}},n.onerror=function(e){showErrorMessage(e.toString())},n.readAsArrayBuffer(t)}function isFontVariable(e){return!!e.axes}function setFont(n,a){opentype.load(n,function(e,t){onFontLoaded(t,n,a)})}window.onload=function(){var r=document.getElementById("section__header-file-buttons");if("localhost"===location.hostname||"127.0.0.1"===location.hostname||""===location.hostname){document.getElementById("section__header-file-buttons").innerHTML="Place fonts you want to proof into <code>/fonts</code> to begin";var f="",c="",d="";$.get("../txt/fonts.txt",{},function(e){d=e.split("fonts/");for(var t,n=[],a=0;a<d.length;a++)""!=d[a]&&(thisFont=d[a].trim(),n.push(thisFont));preserveUnique(n);for(a=0;a<n.length;a++){var i=n[a],o=i.replace(".","-");f+='<button class="btn btn__setfont" id="btn__setfont-'+o+'" onclick="setFont(\'fonts/'+i+"', '"+o+"')\">"+i+"</button>",c+='@font-face { font-family: "'+o+'"; src: url("fonts/'+i+'");}'}if(r.innerHTML=f,localStorage.getItem("fontFamilySource"))var s=localStorage.getItem("fontFamilySource"),l=localStorage.getItem("fontFamily");else s="fonts/"+n[n.length-1],l=o;for(setFont(s,l),document.getElementById("btn__setfont-"+l).classList.add("active"),$("#style__fontface").append(c),console.log("local storage"),t=0;t<localStorage.length;t++)console.log(localStorage.key(t)+"=["+localStorage.getItem(localStorage.key(t))+"]")},"text")}else{setFont("fonts/gooper-VF.ttf","gooper-VF-ttf"),$("#style__fontface").html('@font-face { font-family: "gooper-VF-ttf"; src: url("fonts/gooper-VF.ttf");}'),r.innerHTML='<input id="fontInput" type="file"><div id="message"></div>',document.getElementById("fontInput").addEventListener("change",onReadFile,!1)}$("#section__header-file-buttons").on("click",".btn__setfont",function(){$(this).addClass("active").siblings().removeClass("active")}),$("#section__header-stage-buttons").on("click",".btn__setstage",function(){$(this).addClass("active").siblings().removeClass("active")}),$("#btn__view-tools-toggle").on("click",function(e){$(".body__idiotproofed").toggleClass("tools-visible")}),document.body.className+=" loaded"};